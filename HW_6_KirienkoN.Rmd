---
title: "HW6"
author: "Kirienko Nadezhda"
date: "2024-04-17"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
**Тема: расчет выборки при планировании исследования.**

Описание ДЗ:
При выполнении этого домашнего задания вам необходимо посчитать выборки для различных типов точек. Напишите соответствующий код, пользуясь указанными формулами.

Пусть наш спонсор заинтересован, чтобы исследование имело 80% мощность, а уровень значимости — 5%, ожидаемый drop-out rate = 10%.

 - Задаем общие условия для задач, обозначенные спонсором и находим квантили нормального распределения для них.
```{r}
alpha <- 0.05
beta <- 0.2
dropout_rate <- 0.1

z_alpha_2 <- abs(qnorm(1 - alpha/2))
z_beta <- abs(qnorm(beta))

z_alpha_2
z_beta
```
 **Задание 1**
 Рассчитайте выборку для исследования терапевтической эквивалентности для двухпериодного cross-over дизайна. Из предыдущих исследований известно, что дисперсия составляет 20% (sigma = 0.20), а разница средних составляет −10% (epsilon). Клиницисты сообщают нам, что клинически значимая разница составляет 25% (delta = 0.25).
 
1а - устанавливаю заданные параметры:
```{r}
sigma <- 0.20
epsilon <- 0.1
delta <- 0.25

```
1б- Рассчитываю выборку для исследования (отдельно для каждой группы, с учетом ropout_rate и учитывая оба приеода )
```{r}
n <- ((z_alpha_2 + z_beta)^2 * sigma^2) / (2 * (delta - abs(epsilon))^2)
n <- n / (1 - dropout_rate)
n_total <- n * 2
```
1С - просмотр резульата:
```{r}
cat("Выборка для исследования терапевтической эквивалентности для двухпериодного cross-over дизайна:\n")
cat("Размер выборки для каждой группы (n1 = n2):", round(n), "\n")
cat("Общий размер выборки (учитывая оба периода):", round(n_total), "\n")
```
**Задание 2**
Рассчитайте выборку для гипотезы non-inferiority для двухвыборочного параллельного дизайна. Пусть клинически значимая разница  δ = -0.1, то есть мы ожидаем разницу не меньше 10%, а долю ответов для тестового препарата p2  = 0.65, в то время как нам известно из предыдущих исследований, что доля ответов у препарата сравнения составляет p1  = 0.85. Соотношение групп равно k  = 1.

2а - устанавливаю заданные параметры:
```{r}
delta <- -0.1
p1 <- 0.85
p2 <- 0.65
k <- 1
```
2б- Рассчитываю выборку для исследования (отдельно для каждой группы, с учетом ropout_rate и учитывая оба приода )

```{r}
n <- ((((z_alpha_2 + z_beta)^2) * (p1 * (1 - p1) + p2 * (1 - p2))) / (p1 - p2 - delta)^2) * k
n <- n / (1 - dropout_rate)
n_total <- n * 2
```
2С - просмотр резульата:

```{r}
cat("Выборка для гипотезы non-inferiority для двухвыборочного параллельного дизайна:\n")
cat("Размер выборки для каждой группы (n1 = n2):", round(n), "\n")
cat("Общий размер выборки (учитывая оба периода):", round(n_total), "\n")
```
**Задание 3**

 Рассчитайте выборку для гипотезы equality для следующего исследования. Мы хотим сравнить новую терапию инфекции, присоединяющейся в больничных условиях у пациентов с ожогами, с золотым стандартом, основываясь на данных, анализируемых с помощью регрессии Кокса. Пусть отношение рисков «золотой стандарт / новая терапия», hazard ratio, HR = 2. Мы предполагаем, что 80% пациентов (d = 0.8) могут столкнуться с этим заболеванием. Соотношения групп терапии равны (p1=p2=0.5).

3а - устанавливаю заданные параметры:
```{r}
HR <- 2
d <- 0.8
p1 <- 0.5
p2 <- 0.5
```
3б- Рассчитываю выборку для исследования (отдельно для каждой группы, с учетом ropout_rate и учитывая оба приода )

```{r}
n <- ((z_alpha_2 + z_beta)^2) / ((log(HR)^2) * p1 * p2 * d)
n <- n / (1 - dropout_rate)
n_total <- n * 2
```
3С - просмотр резульата:

```{r}
cat("Выборка для гипотезы equality для исследования с регрессией Кокса:\n")
cat("Размер выборки для каждой группы (n1 = n2):", round(n), "\n")
cat("Общий размер выборки (учитывая оба периода):", round(n_total), "\n")
```

